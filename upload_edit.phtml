<input type="file"  id="upload_img" name="upload_img" class="remove" /><script type="text/javascript">// 滚动重置function slide_iframe(){    if($(".tpl-login").length){      $(".tpl-login").each(function(){          $(this).get(0).contentWindow.Civen.slide();      })    }    if($(".tpl-home").length){      $(".tpl-home").each(function(){          if($($(this).get(0).contentDocument).find(".slide").length)            $(this).get(0).contentWindow.Civen.slide();      })    }}var loading = new Civen.loading("加载中....");//添加图片var bg_pid = false;var upload_act = 0;var pic_width = 0;var pic_height = 0;var img_act = 0;var rep_iframe_obj = '';var rep_img_obj2 = '';var rep_get_id = '';var change_height = '20%';var positions = 0;<?php $conf_tpl = $this->tpl_conf?>var max_total = <?php echo (isset($conf_tpl['bg_img']) && $conf_tpl['bg_img'])?$conf_tpl['bg_img']:3;?>;//添加背景图片Civen.upload({	file_input: "[type=file]",	url: $web_url+"/image/upload",	expansion:{		width: function(){ return  pic_width;},		height: function(){ return  pic_height;},	},	onstart: function(){		if(upload_act == 3) { //背景图片上传    		var bg_img = $("#login_edit").find(".upload_bg_img");        var bg_img_right = $("#desk_edit").find(".upload_bg_img");    		var len = 0;        var len_right = 0;        if(positions){          // 拆分          if(positions == 1){            // 认证页            if(bg_img){               len = bg_img.length;             }            //最多上传图片限制            if(max_total <= len) {                Civen.message('最多上传背景图片：'+max_total+'张', "error");                $("#login_edit").find("#background_add").hide();                return;            }          }          if(positions == 2){            // 首页            if(bg_img_right){               len_right = bg_img_right.length;             }            if(max_total <= len_right) {                Civen.message('最多上传背景图片：'+max_total+'张', "error");                $("#desk_edit").find("#background_add").hide();                return;            }          }        }else{            // 不拆分            if(bg_img){               len = bg_img.length;             }            //最多上传图片限制            if(max_total <= len) {                Civen.message('最多上传背景图片：'+max_total+'张', "error");                $("#login_edit").find("#background_add").hide();                return;            }        }		}    loading.start("正在上传");		return true;				},	onend: function(){    	loading.end();    	return false;	},	callback: function(data, obj){		        if(upload_act == 1) {//上传logo图片  			  $('#logo_img').attr("src",$img_url+data.img_url).parent().show();  			  $("#logo_pid").val(data.data);  			  $('#logo_add').hide();  				//更新预览logo          $(".tpl-login").each(function(){  				  $($(this).get(0).contentDocument).find('.view_logo').attr('src',$img_url+data.img_url);            if($($(this).get(0).contentDocument).find('iframe').length){              $($($(this).get(0).contentDocument).find('iframe').get(0).contentDocument).find('.view_logo').attr('src',$img_url+data.img_url);            }          })          $(".tpl-home").each(function(){            $($(this).get(0).contentDocument).find('.view_logo').attr('src',$img_url+data.img_url);            if($($(this).get(0).contentDocument).find('iframe').length){              $($($(this).get(0).contentDocument).find('iframe').get(0).contentDocument).find('.view_logo').attr('src',$img_url+data.img_url);            }          })        } else if(upload_act == 2) {//更换logo图片  			  $('#logo_img').attr("src",$img_url+data.img_url).parent().show();  			  $("#logo_pid").val(data.data);  			  $('#logo_add').hide();  				//更新预览logo          $(".tpl-login").each(function(){            $($(this).get(0).contentDocument).find('.view_logo').attr('src',$img_url+data.img_url);          })          $(".tpl-home").each(function(){            $($(this).get(0).contentDocument).find('.view_logo').attr('src',$img_url+data.img_url);          })			          } else if(upload_act == 3) {//上传背景图片          var bg_img = $("#login_edit").find(".upload_bg_img");          var bg_img_right = $("#desk_edit").find(".upload_bg_img");          var len = 0;          var len_right = 0;          if(positions){            // 拆分            if(positions == 1){              // 认证页              if(bg_img){                 len = bg_img.length;               }              //最多上传图片限制              if(max_total <= len) {                  Civen.message('最多上传背景图片：'+max_total+'张', "error");                  $("#login_edit").find("#background_add").hide();                  return;              }            }            if(positions == 2){              // 首页              if(bg_img_right){                 len_right = bg_img_right.length;               }              if(max_total <= len_right) {                  Civen.message('最多上传背景图片：'+max_total+'张', "error");                  $("#desk_edit").find("#background_add").hide();                  return;              }            }          }else{              // 不拆分              if(bg_img){                 len = bg_img.length;               }              //最多上传图片限制              if(max_total <= len) {                  Civen.message('最多上传背景图片：'+max_total+'张', "error");                  $("#login_edit").find("#background_add").hide();                  return;              }          }      	            // 添加操作图片        	var img_html = '<div class="one-third" id="pid_bg_'+data.data+'">\              <div class="img-wrap preview">\              <input type="hidden" class="pid_list" value='+data.data+' alt="'+positions+'"/>\                <img class="upload_bg_img" style="height:160;" src='+$img_url+data.img_url+' alt="'+positions+'"/>\                <div class="mask bg-orange absolute full-size top left">\                  <p style="margin-top:'+change_height+';">\                    <a><label  onclick="return bg_move('+data.data+');" role="button">\                      <input type="file" act="4" name="bg_img" class="remove" />更换</label>\                    </a>\                    <a style="margin-left:20%;" onclick="del_bg_img('+data.data+','+positions+')" >\                      <label role="button">删除</label>\                    </a>\                  </p>\                </div>\                </div>\                <br/>\                <input type="text" name="url" class="bg_url hide" value="" placeholder="请输入背景地址" style="width:98%;display:none;"/>\              </div>';    			    		if(!positions) $("#background_add").before(img_html);        if(positions == 1) $(".background_add_1").before(img_html);        if(positions == 2) $(".background_add_2").before(img_html);        if($("#bg_open").is(':checked')){          $(".bg_url").show();        }    		len = $("#login_edit").find(".upload_bg_img").length;        len_right = $("#desk_edit").find(".upload_bg_img").length;    		    		if(max_total == len) {        			$("#login_edit").find("#background_add").hide();    			    		}        if(max_total == len_right) {              $("#desk_edit").find("#background_add").hide();                  }        // 替换预览图片        if(!positions || (positions == 1)){          $(".tpl-login").each(function(){            var iframe_obj = $($(this).get(0).contentDocument);            var ul_bg_img_obj = iframe_obj.find(".ul_bg_img");             ul_bg_img_obj.append("<li class='bg_img_"+data.data+"'><img src='"+$img_url+data.img_url+"' ></li>");              var banner_img = iframe_obj.find(".banner_img");            if(banner_img) {              banner_img.attr("src", $img_url+data.img_url);            }          })        }        if(!positions || (positions == 2)){        $(".tpl-home").each(function(){            var iframe_obj = $($(this).get(0).contentDocument);            var ul_bg_img_obj = iframe_obj.find(".ul_bg_img");             ul_bg_img_obj.append("<li class='bg_img_"+data.data+"'><img src='"+$img_url+data.img_url+"' ></li>");              var banner_img = iframe_obj.find(".banner_img");            if(banner_img) {              banner_img.attr("src", $img_url+data.img_url);            }          })        }        // 删除默认图片        if(!positions || (positions == 1)){          $(".tpl-login").each(function(){            $($(this).get(0).contentDocument).find('.default_bg_img').remove();          })        }        if(!positions || (positions == 2)){          $(".tpl-home").each(function(){            $($(this).get(0).contentDocument).find('.default_bg_img').remove();          })        }        slide_iframe();		}else if(upload_act == 4) {//更换背景图片      // 更新操作图片			$("#pid_bg_"+bg_pid+" img").attr("src", $img_url+data.img_url);			$("#pid_bg_"+bg_pid+" .pid_list").val(data.data);			      // 更新预览图片      $(".tpl-home").each(function(){        var iframe_obj = $($(this).get(0).contentDocument);        iframe_obj.find(".bg_img_"+bg_pid).children("img").attr("src", $img_url+data.img_url);		    var banner_img = iframe_obj.find(".banner_img");  			  			if(banner_img) {  				banner_img.attr("src", $img_url+data.img_url);  			}      })      $(".tpl-login").each(function(){        var iframe_obj = $($(this).get(0).contentDocument);        iframe_obj.find(".bg_img_"+bg_pid).children("img").attr("src", $img_url+data.img_url);        var banner_img = iframe_obj.find(".banner_img");                if(banner_img) {          banner_img.attr("src", $img_url+data.img_url);        }      })      del_bg_img(bg_pid,positions,1);      bg_pid = false;      slide_iframe();           				}else if(upload_act == 5){      $('iframe').each(function(){        var iframe_obj = $($(this).get(0).contentDocument);        if(iframe_obj.find(".view_img_upload_"+rep_iframe_obj).length){          iframe_obj.find(".view_img_upload_"+rep_iframe_obj).attr("src",$img_url+data.img_url);        }      })      if(rep_img_obj2) rep_img_obj2.attr("src",$img_url+data.img_url);      rep_get_id.attr('imgid',data.data);    }else if(upload_act == 6){      var judg = '';      if(rep_iframe_obj) judg = rep_iframe_obj;      other_upload_action(data,judg);    }    // 重置iframe    //Civen.slide();    //slide_iframe();    /*$('iframe').each(function(){      this.contentWindow.Civen.slide();    })*/        loading.end();    Civen.message('上传成功!', "success");	}});function logo_upload(w,h) {    upload_act = 1;    if(w) pic_width = w; else pic_width  = 110;    if(h) pic_height = h; else pic_height = 110;}function logo_move(w,h) {    upload_act = 2;    if(w) pic_width = w; else pic_width  = 110;    if(h) pic_height = h; else pic_height = 110;}function bg_upload(w,h,p){        upload_act = 3;    if(w) pic_width = w; else pic_width  = 888;    if(h) pic_height = h; else pic_height = 528;    if(p) positions = p; else positions = 0;    if(w == 640) change_height = '40%';}function bg_move(pid,w,h){    upload_act = 4;    if(w) pic_width = w; else pic_width  = 888;    if(h) pic_height = h; else pic_height = 528;	  bg_pid = pid;}function img_upload(iframe_obj,replace_img_obj2,get_id_obj,w,h){    rep_iframe_obj = iframe_obj;    rep_img_obj2 = replace_img_obj2;    upload_act = 5;    if(w) pic_width = w; else pic_width  = 110;    if(h) pic_height = h; else pic_height = 110;    rep_get_id = get_id_obj;}function other_upload(w,h,params){    upload_act = 6;    if(params) rep_iframe_obj = params;    if(w) pic_width = w; else pic_width  = 110;    if(h) pic_height = h; else pic_height = 110;}</script>